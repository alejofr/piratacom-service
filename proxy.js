import express from 'express';
import https from 'https';
import fs from 'fs';
import { createProxyMiddleware } from 'http-proxy-middleware';

const SESSION_TOKEN = 'eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0..VYXdZngs9Mr76sji.TdSguhjl5paPRt7bZcZ_lv-GRQhJ6vXGD6YLNDSs739S1oLLY4IMvnjjsLV0SXTRdTp60bxK-hXvrh2iNt1uXymeKYx3417MVAdAWzAmuYnz4roiDCe_-6HwqkFJNgnzRc26qDwgexC1H1ED8accxhZo2ePBHiUBDU6b7N6CNmm_LwLon75Wk96EEYX-8s5HRZXU7AnDQDOYmmLdJoyPrY-acej5sTzHohvxz2xL2-gJ5QWdEArd6qaClumfjSutRw7wHZwXXpsL3bQDIdIwghYR4_2X7JuP5sdx4GKycS-o0Tcl5u8bGM7y2Cml8xM3Rb1DFzroESW53JC9etbNfSUpdcShEePYOlWPKKPyTFX-xjh0xn9RMCHCeaeX75DuG1HAtcjj1PLt_llQNMHoWPC56Qmgg1RQELa26IoYF9_wDdJmAQpgYzEqKP_QqvjSPJbCzU0uP1aPQQpMFUcnf-CCRdHcSSr9zCH6RLq7wtu50L8cfl6F3cvaP9-sVi1inhnAwhYEo81dkKujuMSy2aNe15J6L8dw5F4jcn_m6LX2i-27gE56K4lhzrfZF-zrW4uimadkbIadKUBuH0Tz6zNQ17UpHPfINGMhZJVkh63TkrbIZt7PZrWeG_mdEpN__0jNvmceGdl50DOBrcgp0csCd6Cr1W8Ei3CmAexliqsME6srZZEtYETzcUNX5fBeq318dj4Y6s3MxxN_I4veDC6Db9yqSazU_He7FJVh98XWb0x3wK029ZXPl1glxIbS3GVfUT9ZCSUgyFd63xMY5zpD71y6iQz1D1z3B0HVR3xV3vLB2EHMqdrRh8BEiFgMsP5JviAJRTTwAelqmzns_uScVBvpfj84HT_lD3ubyR2KG-nyFoYXcgCfLcRAavHwh5eOhqDQmG9Vm6m5L9lcU1_cEkp2cxPfOTE0UVJv4soLmdglYd1ERqYJhSWfGV-LnGqDhOpXxBF8jYaKXFCkUtVBfClEjM_1_uNg_wPQqImrLeRnQ8y_doNVX52ShkIn4TEtw-FeUVASETD2X5DR9hGWw2bJ9MrNytjD_oZSM58-2OVd3qV5YgKkIMtkJ2xp1-QJffOPaosj9YuxwZrFJtsByIeeBxyCXRze06QVB2XgTaxJy3eXZkbs8iGUfBMWD4GzX-ULfZAz8bcGllqC16o5q9eiz6-ZdQkzcMI7j7XErRbqMhn6QvgiE15MnOdZOXCW2FbGf5ltrOhHkrr1jwktoZ4KXYQltmAbVfMcVKuXtruUaP6Gc4XhkYh_gAZTFUJQmQSSGcK8jv5m7nMzMOyjaoTEUCWds6ISUlOiubf2V_CuMt0onnoh--1HaODQLK43_F8HWGhYaMd_xCJgEUy3uIWVNmwDTi9SrmL5HK7wIekMy9WRiD8LZb3YqJBx_mVYntJgNiUEAr0dSg-S5TGGJbZS4GZHVsPPwkprkRY0OfrHoG4KkF1SKrroWdImZLSI0JCdzuT_PpRCXHjhjpESUGBbNRB1VI7T_7NGjSu1bKSnPhXB7nNvcax3cQG6fxWHDFod_YiX-mBagWOHvL5aUSG-BwD68tTAFy5506zyOANZVZEt1RKjIHzvNC34ZZzdB_pZDcXBv4Gp2ueZ0O9UMpM9u66tcYJM1PBIt7Wqhiaagw2V7E0y-0actIvQm5p4iDik8dh_6SEc7KNrBVL6zRppHCNuA8r-t-upaxgKpxjTf-3KVXg2ViEdpn9vFI5hXyui4Ip_QAD5En0fXkK0lMitlyFJOzD83Bvkr09QpxWsQwElES_udlGBz0snkz6ImYP81FNYcQcgskYOWbCeHlOkk7dRZpxIVtLZHMalpjVuXo7ty3znbeE-9HiJ1789FbRUdV_8TBmuwpkAhZraT2lZvVnoeFI-zFc5WOYGCsE-RC5BXBrjljqjl3Mxn8gSFbbZ8pu4GpdBQVVKGCZgcMp1WWFwCwnKbnedw9_hmNbC9b-cCyL4dc8WjhT9sTA35tG-8fsp8OOTQyVDpKKSFagnZ0V2X-Q-mB4tnj8uuP2vFGJOp8D1rbU9GEzpvMhvXVy-7VKVetB2ueIgGuK9aRmkOQX7JAuhrWtp0-b8WCHZkrgpfSifJGSfZk97XbasQv5YDwZcw8bMJWfzgMZikBa5lsg7pX3QEZvNqvfSlOz4NfNXXYQzxYe6jw5cep_xTpYvwnOLLVW5ieX1950XFZX0DbR49ylt7k9NdBpzawUKlA6GujqLe_qMVVWYwabdUJC2lpdG9NuE4ewHMngq_cZHbBrkhYcDweXQYu0Qc7hYmzTTI25fPwgWnUzh9A2gh98jwIcS1gve2bsAiGiENslbo4kQSkfJTjxgETEZM4xqspX_H5BqeCoi3zUNT174QT0UPr3nl6mxTBSZC6j-rCBpZa4pf2JLPcHUBggW4JNrPmGnwj4vxVL9jrWA67fp8maDC-MEfU1iTPsUE3IIGmqOjBi3wK5vzTW5L-XzHRBopFJyfC114rC7rbZfCs2QZw-eDSU5UWwl33iW8xHB3umF6uyi91cWo8jfH_hAUxU54vhQUqDXTqTNadiN9GAFbJr27Rj0OAZWWBFF85wJR8SizWVryrUt-dMZY2yCXNeezoaxEN2WVPhLfRA3w3iJUfrrm3kvfBNM7aDKvEWF9VwrXY3D2hRGDRyydaYm5vMG9f4qDaxX5bYQGkfPw_ZoY9CTtLdOMCVwX-3TihXcoHY3BPmygvGYonFsc-LydQX5LQi-G-LF-QpSiVJbSvfqOq9tl9_wsYQ0HQgZ9f2dy3CayQZaPvOiUPZAyiHK7Nuhq9XeFliotNWUhV7q2vK9u-iZYTZ0G5flIGy-dPi7jEeb7l5GyIRqVqF6FO0jnDTu5yeQlsAJxunlPQPbujcF4iKzIWzK2h8M7M3yB2CG32O8ibpVqjca0kyVwNvax5p1HByhuUm5RedBDYklLLE8WBU8Ps8TranV3l40uw4TKYJBA-1encNuthWvyBL_sKrzoM1mq25gYgftZzHIIuLjpHN2dzBdwyIeOIDssn7SM-G9naVOH0yI8dMX33YzsIwYEFc1GjI99jzjhCVOGEEkfdmxMk97S-Vs-oQpXovlbXqLVkKMbh5tvASE8YxT8HTU2V0-ORum51lo-IKg74RfcNuAnLqcHzQPKKueMAg0Yvzr-SLcLWt-ALAW2Ck-xQ1GCaZAUFWvG-3qt3QLzFhI8ZNVg75ogRoboDK6Bs6wM2NS-nhN3zU0A4yq5bvjujXSNgxMx6AJraEjCu9rvHdn0iDRC-o.69wYdRWvr6zGbIbPbR9Tng'
const CALLBACK_URL = 'https%3A%2F%2Fchatgpt.com%2F'; // Reemplaza si es necesario

const app = express();

const options = {
  key: fs.readFileSync('server.key'),
  cert: fs.readFileSync('server.cert')
};


app.use('/', createProxyMiddleware({
  target: 'https://chatgpt.com',
  changeOrigin: true,
  secure: false,
  onProxyReq: (proxyReq, req, res) => {
    proxyReq.setHeader('cookie', `__Secure-next-auth.session-token=${SESSION_TOKEN}; __Secure-next-auth.callback-url=${CALLBACK_URL};`);
  },
  onProxyRes: (proxyRes, req, res) => {
    proxyRes.headers['Access-Control-Allow-Origin'] = '*';
    proxyRes.headers['Access-Control-Allow-Credentials'] = 'true';
  }
}));

https.createServer(options, app).listen(3000, () => {
  console.log('Servidor HTTPS en https://18.217.9.138:3000');
});